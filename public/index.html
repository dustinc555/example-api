<!DOCTYPE html>
<html>
  <head>
    <title>notable</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  <body>
    <div class="container">
        <div class="row">
          <div class="col-sm" style="background-color: lightgray;">
            <h1 class="text-primary">notable</h1>
            <h2>Physicians</h2>
            <ul id="physician_list"></ul>
          </div>
          <div class="col-sm">
            <h2 id="physician_title"></h2>
            <h5 id="physician_email"></h5>
            <table class="table table-bordered" id="appointments"><thead class="bg-primary"></thead></thead><tbody></tbody></table>
          </div>
        </div>
    </div>
</html>

<script>

function focusPhysician(physician_name, physician_email, physician_id) {
    $("#physician_title").text(physician_name)
    $("#physician_email").text(physician_email)

    get_physician_appointments = "http://localhost:9080/physicians/appointments/" + physician_id;

    // clear table
    $("#appointments tr").remove()
    var table = $('#appointments thead');
    tr = $("<tr></tr>").appendTo(table);
    tr.append( "<td>#</td><td>Name</td><td>Time</td><td>Kind</td>" );

    $.ajax({
        url: get_physician_appointments,
        type: "get",
        dataType: "json",
        success: function (response) {
            console.log(response)
            $.each(response, function( key, val ) {
                table = $('#appointments tbody');
                tr = $("<tr></tr>").appendTo(table);
                tr.append( "<td>" + val._id + "</td><td>" + val.name + "</td><td>" + val.time + "</td><td>" + val.kind + "</td>" );
            });
        },
    })
}


function populatePhysicians() {
    get_physicians_url = "http://localhost:9080/physicians";

    $.ajax({
        url: get_physicians_url,
        type: "get",
        dataType: "json",
        success: function (response) {
            console.log(response);
            $.each(response, function( key, val ) {
                let physician_element = document.createElement("li")
                physician_element.innerText = val.name
                physician_element.setAttribute('data-id', val._id)
                physician_element.setAttribute('data-name', val.name)
                physician_element.setAttribute('data-email', val.email)
                physician_element.classList.add('physician_elements')

                $("#physician_list").append(physician_element)
            });
        },
    })

    $("#physician_list").on("click", "li", function() {
        console.log($(this).attr('data-id'))
        console.log($(this).attr('data-name'))
        console.log($(this).attr('data-email'))

        ph_name = $(this).attr('data-name')
        ph_email = $(this).attr('data-email')
        ph_id = $(this).attr('data-id')
        focusPhysician(ph_name, ph_email, ph_id)
    });
}

populatePhysicians()


</script>
